

#  通用控制器（C002）协议

设备协议原则：

1、按键申请主控设备号

3、外挂设备通过扫码识别类型绑定到数据库(执行器或传感器)

4、数字输出：2路，参数：路数1byte,状态1byte,设备类型id:

5、模拟输出：2路，参数：路数1byte,值3byteBCD码,单位V设备类型id:

6、数字输入：2路，参数：路数1byte,状态1byte,设备类型id:  

7、模拟输入：2路，参数：路数1byte,值3byteBCD码,单位V,(4-20ma,0-10V)

8、485设备：最多32路，参数：透传数据nbyte,设备类型id:  单独罗列

## 通用控制器各id字段解释

- **控制器设备类型（DeviceTypeId）：**LoRa通用控制器（C002）

  > `控制器设备类型指`：每种大类型控制器的类型ID,比如卷膜机控制器、通用控制器等，该控制器需要按键上报LoRa参数，并配置SN等。

- **输入输出接口类型(InterfaceTypeId)：**数字输出（C003）【数字输出1,2路为普通数字输出；3,4路为继电器输出】、模拟输出（C004）、485接口（C005）、数字输入（0004）、模拟输入（0005）

  > `输入输出接口类型指`：控制器下外挂的接口，如：数字输入输出、模拟输入输出、485接口等

- **子设备类型（SlaverTypeId）:**每个输出接口挂载的设备的类型，在每种接口通讯协议后附带罗列

  > `子设备类型指`：某种接口下外挂的设备类型，如：数字输出（C003）下外挂的设备是电磁阀，其SlaverTypeId为0001

- 初始化原则：

  > 一个设备第一次发送申号指令时，区域ID以及SN全为0，然后就等待主机发送其他的设置指令。

## 一、通用控制器公共指令

### 1、查询LORA主设备的参数（当前区域以及SN）frameId:A011）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |        8-16        |  17  |       18-23       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |         SN         | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |      DeviceSN      | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |         9          |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A011   |    04    |       C002       |     00      |   01   | XXXXXXXXXXXXXXXXXX |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A011                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| DeviceSN        | SN               |      9       | C00220190805150901（主设备类型ID+年月日+时间+星期几）        |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

查询通用控制器（C002）【XX代表无所谓什么数值】

```c
61 0C0E2418 000000 FE A011 0D C002 00 XX XXXXXXXXXXXXXXXXXX D6 0D0A0D0A0D0A
```



### 1、设置LORA主设备当前的区域以及SN（frameId:A013）--

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |        8-16        |  17  |       18-23       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |         SN         | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |      DeviceSN      | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |         9          |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A013   |    0D    |       C002       |     00      |   01   | XXXXXXXXXXXXXXXXXX |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A013                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| DeviceSN        | SN               |      9       | C00220190805150901（主设备类型ID+年月日+时间+星期几）        |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

设置通用控制器（C002）的区域为02区,SN为XXXXXXXXXXXXXXXXXX

```c
61 0C0E2418 000000 FE A013 0D C002 00 02 XXXXXXXXXXXXXXXXXX D6 0D0A0D0A0D0A
```



### 2、按键上报当前参数（frameId:E011)

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |        8-16        |  17  |       18-23       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |         SN         | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |      DeviceSN      | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |         9          |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  E011   |    0D    |       C002       |     00      |   00   | XXXXXXXXXXXXXXXXXX |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A011                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| DeviceSN        | SN               |      9       | C00220190805150901（主设备类型ID+年月日+时间+星期几）        |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

按键上报当前的设备参数，申号

```c
61 14052A0C 000000 FE E011 0D C002 00 00 000000000000000000 00 0D0A0D0A0D0A
```



### 3、设置某类型接口挂载的某一路子设备类型及工作组（frameId:A020）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |        8-9         |    10    |    11-12     |    13-17     |  18  |       19-24       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------------: | :------: | :----------: | :----------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 输入输出接口类型ID | 设备路数 | 子设备类型ID | 子设备工作组 | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  interfaceTypeId   | channel  | slaverTypeId | groupIdArray | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |         2          |    1     |      2       |      5       |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A020   |    0E    |       C002       |     00      |   01   |        C003        |    01    |     0001     |  0100000000  |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明               | 长度（byte） | 备注                                                         |
| --------------- | :----------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头           |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址           |      4       |                                                              |
| deviceOthers    | 控制字等           |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头               |      1       | FE                                                           |
| frameId         | 帧ID               |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度           |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID   |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播           |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id             |      1       |                                                              |
| InterfaceTypeId | 输入输出接口类型Id |      2       |                                                              |
| channel         | 设备路数           |      1       | 该接口设备的路数，从01开始编号                               |
| slaverTypeId    | 子设备类型id       |      2       | 查看各接口协议子设备类型对照表                               |
| groupIdArray    | 子设备工作组数组   |      5       | 设备最多可以在某类型下的5个组内，默认在全部组                |
| CRC8            | CRC8校验码         |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾               |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

设置通用控制器（C002）通用输出接口(C003)路数为1的挂载设备为电磁阀（0001），其所处工作组为1\3\5组（0103050000）

```c
61 0C0E2418 000000 FE A020 0E C002 00 01 C003 01 0001 0103050000 D6 0D0A0D0A0D0A
```



### 4、通用回执指令（frameId:E020）

出厂模式、设置子设备类型及工作组成功/失败、设置数字输出状态成功/失败、设置模拟输出成功/失败、设置关联状态成功/失败、设置预留字段成功/失败、数字输出设备1开启/关闭、数字输出设备1开启/关闭、模拟输出设备1开启/关闭、模拟输出设备2开启/关闭、

**通用回执状态表**：

| 状态名称 | Factory Mode | Set  Area and SN Success | Set  Area     and SN Failure | Set subdevice type and workgroup success | Set subdevice type and workgroup failed | Set digital output status success | Set digital output status failed | Set analog output status success | Set analog output status failed | Set association status  succeed | Set association status  failed | State Storage Exceeding the Upper Limit | Set reserved field success | Set reserved field failed | Data loss due to abnormal power_off |      |      |      |      |      |      |      | Data loss due to abnormal power_off |      |      |      |
| -------- | ------------ | ------------------------ | ---------------------------- | ---------------------------------------- | --------------------------------------- | --------------------------------- | -------------------------------- | :------------------------------- | :-----------------------------: | :-----------------------------: | :----------------------------: | --------------------------------------- | :------------------------: | :-----------------------: | :---------------------------------: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :---------------------------------: | :--: | :--: | :--: |
| 状态值   | 00           | 01                       | 02                           | 03                                       | 04                                      | 05                                | 06                               | 07                               |               08                |               09                |               0A               | 0B                                      |             0C             |            0D             |                 0E                  |  0F  |  10  |  11  |  12  |  13  |  14  |  15  |                 16                  |  17  |  18  |  19  |
| 状态说明 | 出厂模式     | 设置主设备区域及SN成功   | 设置主设备区域及SN失败       | 设置子设备类型及工作组成功               | 设置子设备类型及工作组失败              | 设置数字输出状态成功              | 设置数字输出状态失败             | 设置模拟输出成功                 |        设置模拟输出失败         |        设置关联状态成功         |        设置关联状态失败        | 关联状态失败，存储超上限                |      设置预留字段成功      |     设置预留字段失败      |          异常断电数据丢失           |      |      |      |      |      |      |      |                                     |      |      |      |

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |   8    |       9-16       |  17  |       18-23       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----: | :--------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 状态值 |     预留字段     | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | status |     Allocate     | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |   1    |        8         |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  E020   |    0D    |       C002       |     00      |   01   |   xx   | 0000000000000000 |  D6  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A021                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| status          | 状态值           |      1       | 查看E020对应状态表                                           |
| Allocate        | 预留字段         |      8       | 预留的字段                                                   |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

发送A013设置主设备区域以及SN后的通用回执E020应该回执【设置主设备区域及SN成功】对应状态表01

```c
61 14052A0C 000000 FE E020 0D C002 00 0X 01 0000000000000000 D6 0D0A0D0A0D0A
```



### 5、查询输入输出接口状态（frameId:A021）

* zoneId为55表示全部区域
* 设备收到广播查询指令是，上报状态要增加一个延时随机数

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |  8   |       9-14        |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A021   |    04    |       C002       |     00      |   01   |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A021                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```c
61 0C0E2418 000000 FE A021 04 C002 00 01 D6 0D0A0D0A0D0A
```



### 6、查询状态(参数)回执(frameId:E021)

> 说明：不管是批量查询还是单个查询都是分开单独上报状态8**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |      8-9       |     10-11      |     12-14     |     15-17     |     18-20     |     21-23     |  24  |       25-30       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :------------: | :------------: | :-----------: | :-----------: | :-----------: | :-----------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 数字输入IO状态 | 数字输出IO状态 | 模拟输入1状态 | 模拟输入2状态 | 模拟输出1状态 | 模拟输出2状态 | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  digitalInput  |   digitalOut   | analogInput1  | analogInput2  | analogOutput1 | analogOutput2 | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |       2        |       2        |       3       |       3       |       3       |       3       |  1   |         6         |
|   示例数据   |       41        | 14052A0C |   00 XXXX    |    FE     |  E021   |    16    |       C002       |     00      |   01   |      XXXX      |      XXXX      |    XXXXXX     |    XXXXXX     |     XXXXX     |    XXXXXX     |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表E021                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| digitalInput    | 数字输入IO状态   |      2       | 相应的位表示，1高，0低，高位在前低位在后。例如channel 1口状态为高 XXXX XXXX XXXX XXX1 B |
| digitalOutput   | 数字输出IO状态   |      2       | 相应的位表示，1高，0低，高位在前低位在后。例如channel 1口状态为高 XXXX XXXX XXXX XXX1 B |
| analogInput1    | 模拟输入1状态    |      3       | bcd码，单位V                                                 |
| analogInput2    | 模拟输入2状态    |      3       | bcd码，单位V                                                 |
| analogOutput1   | 模拟输出1状态    |      3       | bcd码，单位V                                                 |
| analogOutput2   | 模拟输出2状态    |      3       | bcd码，单位V                                                 |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

通用控制器(C002)数字输出接口（C003）通道1（挂载设备为电磁阀(0001)）当前状态为开启状态

```json
FE E021 0B C002 00 01 C003 0001 01 0001 01 00 0D0A0D0A0D0A
```



## 二、通用输出通讯协议及子设备类型对照表（C003）

### 1.设置某路（或某组）输出设备状态（frameId:A022）

> **MCU解包逻辑：**mcu收到数据后判断isBroadcast，为广播读取groupId，自行判断是哪路来执行控制。单播直接读取channel控制。

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8    |        9-10        |    11    |    12-13     | 14/14-16 | 15-17/17-19 | 18/20 |    19-24/21-26    |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-----: | :----------------: | :------: | :----------: | :------: | :---------: | :---: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |    控制字    |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |  组ID   | 输入输出接口类型ID | 设备路数 | 子设备类型ID | 设定参数 |  工作时间   |  CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | groupId |  interfaceTypeId   | channel  | slaverTypeId |   para   |    time     | CRC8  |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |    1    |         2          |    1     |      2       |   1/3    |      3      |   1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A022   |  0E/10   |       C002       |     00      |   01   |   01    |        C003        |    01    |     0001     |  00/01   |   00000A    |  00   | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明               | 长度（byte） | 备注                                                         |
| --------------- | :----------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头           |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址           |      4       |                                                              |
| deviceOthers    | 控制字等           |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头               |      1       | FE                                                           |
| frameId         | 帧ID               |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度           |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID   |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播           |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id             |      1       |                                                              |
| groupId         | 组id               |      1       |                                                              |
| InterfaceTypeId | 输入输出接口类型Id |      2       |                                                              |
| channel         | 设备路数           |      1       | 该接口设备的路数，从01开始编号                               |
| slaverTypeId    | 子设备类型id       |      2       | 查看各接口协议子设备类型对照表                               |
| para            | 设定参数           |     1/3      | 数字量（00低电平，01高电平），模拟量3byte                    |
| time            | 工作时间           |      3       | 单位S                                                        |
| CRC8            | CRC8校验码         |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾               |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

广播设置通用控制器（C002）通用输出接口(C003)，电磁阀（0001）组1的设备电平状态为高,工作时间10s

```C
61 0C0E2418 000000 FE A022 0E C002 00 01 01 C003 01 0001 01 00000A D6 0D0A0D0A0D0A
```

```c
61 0C0E2418 000000 FE A022 10 C002 00 01 01 C004 01 0001 0110E2 00000A D6 0D0A0D0A0D0A
```

单播设置通用控制器（C002）通用输出接口(C003)，01路电磁阀（0001）设备电平状态为高,工作时间10s

```json
61 14052A0C 000000 FE A021 0B C002 00 01 01 C003 01 0001 01 00000A 00 0D0A0D0A0D0A
```

### 2、通用输出设备（开关型）子设备类型对照表（0001~A000）

| slaverTypeId | 子设备类中文名 | 子设备设备英文名 | 厂家 | 型号 | 购买地址 | 备注 |
| ------------ | -------------- | ---------------- | ---- | ---- | -------- | ---- |
| 0001         | 电磁阀         |                  |      |      |          |      |
| 0002         | 照明灯         |                  |      |      |          |      |
| 0003         | 补光灯         |                  |      |      |          |      |
| 0004         | 消毒灯         |                  |      |      |          |      |
| 0005         | 捕虫灯         |                  |      |      |          |      |
| 0006         | 水泵           |                  |      |      |          |      |
| 0007         | 风机           |                  |      |      |          |      |
| 0008         | 排洪泵         |                  |      |      |          |      |
| 0009         | 打药机         |                  |      |      |          |      |

## 三、设置数字输入关联输出状态(A023)

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |      N       | N+1  |      N+2-N+7      |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 设置参数部分 | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |     para     | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |      N       |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A023   |  0B/0D   |       C002       |     00      |   01   |      N       |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| para            | 设置参数部分     |      N       | 具体数据结构                                                 |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

电平变化及时间间隔到时上报

- X 表示继电器（数字）输入
- Y 表示继电器（数字）输出
- U模拟量输入
- V模拟量输出
- B预留：bool类型预留N个
- I预留：int类型预留N个
- T定时器：单位S
- C计数器：预留N个
- D延时：单位S
- 逻辑关系：大于、小于、等于、位与，位或，小于等于，大于等于，与，或，非，异或，加加，减减，>  <  ==  &  |    ≤  ≥  && ||  ～ ^  ++  --

自控策略数据解析规则：

条件与执行间用`#`分割

多条件间或多条执行参数用间`；`分割

条件及执行参数内部用`，`分割

条件满足及不满足执行参数间用`:`分割

​                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            举例：
​	当数字输入01为高，模拟输入01>大于10V时，数字输出01设为高保持10S时间到后设为低，模拟输出01设为1V保持10S时间到后设为0.5V

```c
X1,=,1;&&;U1,>,1000E2#Y1,1:0,00000A;V1,0100E1:0050E2,00000A
```

开启电磁阀，15S后读取有无水压，有则上报开启成功状态，没有则关闭并上报开启异常状态

```c
X1,=,1;&&;D0,=,F#B0,=,1
B0,=,1;&&;U1,≤,5#X1,0;B0,=,0
```

当水位大于上限（X0）时开始打开污水泵，当水位小于等于下限（X1）关闭污水泵（Y1）

```c
X0,=,1;&&;X1,=,1#Y1,=,1
X0,=,0;&&;X1,=,1#Y1,=,0
```

## 四、设置预留字段（B\I\T\C\D）值（A024）

> **MCU解包逻辑：**mcu收到数据后判断isBroadcast，为广播读取groupId，自行判断是哪路来执行控制。单播直接读取channel控制。

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8     |    N     |  18  |       19-24       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :------: | :------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 设置地段 | 设置参数 | CRC8 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  field   |   para   | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |    1     |    N     |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A024   |    XX    |       C002       |     00      |   01   |    01    |   Nxx    |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| field           | 设置字段         |      1       | 0x01~0x05                                                    |
| para            | 设定参数         |      n       |                                                              |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

广播设置通用控制器（C002）通用输出接口(C003)，电磁阀（0001）组1的设备电平状态为高,工作时间10s

## 五、485设备通讯协议

>  485设备通讯采用透传的方式

### 1、设置485设备参数（A025）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8-     |          |                   |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-------: | :------: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 485的指令 | CRC8校验 |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |  485para  |   CRC8   |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |     N     |    1     |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A025   |   N-4    |       C002       |     00      |   01   |     N     |    00    | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C002）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| 485para         | 485指令          |      N       | 485指令                                                      |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**




变频器



开启或关闭变频器

```json
{
    "confTyp":"FRQ_CON",
    "method":"SET_STATUS",
    "para":{
        "model":"A200",
		"status":1
    }
}
```

设置变频器工作频率

```json
{
    "confTyp":"FRQ_CON",
    "method":"SET_FRQ",
    "para":{
        "model":"A200",
		"frequency":50
    }
}
```

查询

```json
{
    "confTyp":"FRQ_CON",
    "method":"QUERY_STATUS",
    "para":{
        "model":"A200"
    }
}
```

回复

```json
{
    "confTyp":"FRQ_CON",
    "method":"QUERY_STATUS",
    "status":"success",
    "information":"查询A200参数成功",
    "para":{
        "model":"A200",
        "status":0,
        "frequency":0
    }
}
```

## 六、通用回执状态表







